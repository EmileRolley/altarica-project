\documentclass[a4paper]{book}
\usepackage{fullpage}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[francais]{babel}

\usepackage{latexsym}
\usepackage{fancyhdr}
\usepackage{makeidx}
\usepackage{graphics}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{moreverb}
\usepackage{listings}

\newcommand{\altarica}{{\sc AltaRica}}

\begin{document}

\title{Master 1, Conceptions Formelles\\
Projet du module \altarica\\
Synthèse (assistée) d'un contrôleur du niveau d'une cuve}

\date{}

\author{Emile ROLLEY \and Gilles SOUTON}

\maketitle

\chapter{Le sujet}
\input{tank}

\chapter{Le rapport}
Le rapport est sur 20 points.

\section{Processus}

\subsection{Rôle du fichier {\tt GNUmakefile} (1.5 points)}

\begin{itemize}
  \item lignes 1 à 87 : déclaration des variables globales nécessaires pour l'exécution des règles.
  \item règle \texttt{all} : exécute les règles \texttt{sources} et
    \texttt{tank.time} et compile les cibles
    \begin{itemize}
      \item \texttt{sujet.pdf}, \texttt{FD-2021-2022-M1-CC-sujet.tgz},
      \item \texttt{rapport-<user>.pdf}, \texttt{FD-2021-2022-M1-CC-rapport-<user>.tgz},
      \item \texttt{corrige.pdf} et \texttt{FD-2021-2022-M1-CC-corrige.tgz}.
    \end{itemize}
  \item règle \texttt{sources} : exécute \texttt{make all} pour les
    sous-répertoires \texttt{Alt} et \texttt{Spec}.
  \item règle \texttt{tank.time} : pour chaque controleur \texttt{Ctrl} et \texttt{CtrlVV},
    ainsi que pour chaque nombre de défaillances, est créé un fichier \texttt{tank.alt}.
    Ce fichier est l'aggrégation de l'ensembles des fichiers AltaRica du répertoire \texttt{Alt}.
    TODO:
    Elle termine en exécutant la commande \texttt{make} dans tous les
    sous-répertoires : \texttt{Res} \texttt{Controleurs} \texttt{Graphs}
    \texttt{LaTeX}.
\end{itemize}

\subsection{Rôle de la constante {\tt nbFailures} et de l'assertion associée (0.5 point)}

La constante \texttt{nbFailures} corresponds au nombre de maximum de vannes pouvant tombées
en pannes simultanément (\texttt{Valve.stucked == 1}).
Cette condition est assurée par l'assertion :
\begin{verbatim}
# ligne 154 tank.alt
  nbFailures >= (V[0].stucked + V[1].stucked + V[2].stucked);
\end{verbatim}

Par exemple, si les vannes $0$ et $1$ tombent en pannes :
$$
V[0].stucked + V[1].stucked + V[2].stucked = 1 + 1 + 0 = 2
$$

\section{Résultats avec le contrôleur initial {\tt Ctrl}}
\subsection{Calcul d'un contrôleur}
\subsubsection{Avec 0 défaillance (0.5 point)}
\input{LaTeX/System0FCtrl.tex}
\paragraph{Interprétation des résultats}
% A COMPLETER

\subsubsection{Avec 1 défaillance (0.5 point)}
\input{LaTeX/System1FCtrl.tex}
\paragraph{Interprétation des résultats}
% A COMPLETER

\subsubsection{Avec 2 défaillances (0.5 point)}
\input{LaTeX/System2FCtrl.tex}
\paragraph{Interprétation des résultats}
% A COMPLETER

\subsubsection{Avec 3 défaillances (0.5 point)}
\input{LaTeX/System3FCtrl.tex}
\paragraph{Interprétation des résultats}
% A COMPLETER

\subsection{Bilan avec le contrôleur initial (1 point)}
% A COMPLETER

\section{Construction d'un contrôleur initial plus performant}
\subsection{Rôle du composant {\tt ValveVirtual}(2 points)}
\includegraphics[height=.2\textheight,width=.5\textwidth]{Graphs/Valve-modes.pdf}
\includegraphics[height=.2\textheight,width=.5\textwidth]{Graphs/ValveVirtual-modes.pdf}

Le composant \texttt{ValveVirtual} est la représentation en droit d'une valve
physique. Elle permet donc de simuler le fonctionnement et l'évolution d'une
valve \textit{parfaite}, c'est-à-dire, sans contrainte de l'environnement :
elle ne peut donc pas tomber en panne.

Sa sémantique est la suivante :
\begin{itemize}
  \item si les variables \texttt{rate} et \texttt{reateReal} coincïdent, alors l'évènement \texttt{dec} (resp. \texttt{inc})
    permet de décrementer (resp. incrémenter) la valeur de \texttt{rate}.
  \item sinon, dès lors que les variables \texttt{rate} et \texttt{rateReal} se
    désynchronisent, cela signifie que la valve physique est tombée en panne : la valve virtuelle
    n'est alors plus utilisable.
\end{itemize}

\subsection{Rôle du composant {\tt CtrlVV} (4 points)}
% A COMPLETER en expliquant les mécanismes mis en oeuvre, leurs rôles et les
% avantages de ce contrôleur par rapport au précédent CtrlVV.

\section{Résultats avec le contrôleur {\tt CtrlVV}}
\subsection{Calcul d'un contrôleur}
\subsubsection{Avec 0 défaillance (0.5 point)}
\input{LaTeX/System0FCtrlVV.tex}
\paragraph{Interprétation des résultats}
% A COMPLETER

\subsubsection{Avec 1 défaillance (0.5 point)}
\input{LaTeX/System1FCtrlVV.tex}
\paragraph{Interprétation des résultats}
% A COMPLETER

\subsubsection{Avec 2 défaillances (0.5 point)}
\input{LaTeX/System2FCtrlVV.tex}
\paragraph{Interprétation des résultats}
% A COMPLETER

\subsubsection{Avec 3 défaillances (0.5 point)}
\input{LaTeX/System3FCtrlVV.tex}
\paragraph{Interprétation des résultats}
% A COMPLETER

\subsection{Bilan avec le contrôleur CtrlVV (1 point)}
% A COMPLETER

\section{Une première optimisation des contrôleurs pour améliorer le débit aval}
\subsection{Une optimisation basée sur les priorités (1 point)}
\small{\lstinputlisting{ControleursOpt/Optimisation.alt}}
L'optimisation mise en place défini un ordre de priorité sur les différentes
actions sur les vannes. En particulier, sur la vanne aval : $inc > nop > dec$.
Cela forcera donc à choisir les actions maximisant le débit de la vanne aval,
en effet, l'action incrémentant le débit est prioritaire par rapport aux deux
autres et l'action de ne pas modifier le débit est prioritaire à celle le
diminuant.

\subsection{Calcul des contrôleurs optimisés avec {\tt CtrlVV}}
\paragraph{Avec 0 défaillance}\ \\
\input{LaTeX/System0FCtrlVV_opt.tex}

\paragraph{Avec 1 défaillance}\ \\
\input{LaTeX/System1FCtrlVV_opt.tex}

\paragraph{Avec 2 défaillances}\ \\
\input{LaTeX/System2FCtrlVV_opt.tex}

\paragraph{Avec 3 défaillances}\ \\
\input{LaTeX/System3FCtrlVV_opt.tex}

\subsection{Bilan avec la première optimisation du contrôleur CtrlVV (1 point)}

Sans défaillance, tous les objectifs énnoncés pour le contrôleur sont respectés :
\begin{itemize}
  \item $SR = 0$, assure que le system ne peut pas se bloquer ($deadlock = 0$)
    et que le niveau de la cuve ne dépasse jamais les niveau critiques ($NC =
    0$),
  \item $out2 > out1 > out0$, démontre que le débit de la vanne aval est
    maximisé, c'est accentué par le fait que le débit n'est décrementé qu'une
    seule fois ($dec21 = 1 \wedge dec10 = 0$).
    (TODO: est-ce suffisant pour assurer que le débit aval est maximisé ?)
\end{itemize}


Avec une défaillance, tous l'objectif prioritaire énnoncé pour le contrôleur est respecté car $SR = 0$, cependant,
pour l'optimisation du débit aval : TODO: comprendre CCoupGagnant.

A partir de 2 défaillances, le système ne se bloque pas et la niveau de la cuve
ne dépasse pas les niveaux critiques ($SR = 0$), mais cela à un coup car le
système ne possède plus que deux états ($any\_s = 2$).


\section{Une deuxième optimisation (3 points)}
Il est possible d'obtenir de meilleurs résultats que les précédents par au moins deux façons.
\begin{enumerate}
\item En utilisant un meilleur ordre pour les priorités entre événements.
\item En introduisant cet objectif dans le système de calcul de point fixe des actions du contrôleur.
\end{enumerate}

Vous devez proposer une des deux optimisations conduisant à une solution dans laquelle le débit de la vanne aval est le moins souvent possible décrémenter, voire jamais. Pour cela, vous pouvez~:
\begin{itemize}
\item Meilleur ordre sur les événements.
  \begin{enumerate}
  \item Modifier le fichier \texttt{ControleursOpt/Optimisation.alt}.
  \item Faites \texttt{make}.
  \item Quand vos résultats sont satisfaisants, notez les, puis copiez votre fichier dans \texttt{ControleursOpt/Optimisation-2.alt}.
  \item Remettez le fichier \texttt{ControleursOpt/Optimisation.alt} d'origine.
  \item Faites \texttt{make}.
  \end{enumerate}
\item Meilleur système d'équations au point fixe.
  \begin{enumerate}
  \item Modifier le fichier \texttt{Spec/System.spe}.
  \item Faites \texttt{make}.
  \item Quand vos résultats sont satisfaisants, notez les, puis copiez votre fichier dans \texttt{Spec/System-2.spe}.
  \item Remettez le fichier \texttt{Spec/System.spe} d'origine.
  \item Faites \texttt{make}.
  \end{enumerate}
\end{itemize}

\paragraph{Le nouvel ordre}\ \\
\small{\lstinputlisting{ControleursOpt/Optimisation-2.alt}}
% A COMPLETER en décrivant les résultats obtenus

\paragraph{Le nouveau système d'équations}\ \\
\small{\lstinputlisting[texcl]{Spec/System-2.spe}}
% A COMPLETER en décrivant les résultats obtenus

\section{Conclusion sur la synthèse de contrôleur (1 point)}
% A COMPLETER

\end{document}
